"""
é—®å€™å’Œé€šç”¨å¯¹è¯æŠ€èƒ½
"""
from typing import Dict, Any, List
from .base_skill import BaseSkill, SkillResult

class GreetingSkill(BaseSkill):
    """é—®å€™å’Œé€šç”¨å¯¹è¯æŠ€èƒ½"""
    
    def __init__(self):
        super().__init__("é€šç”¨å¯¹è¯åŠ©æ‰‹", "data/greeting")
        self.skill_name = "é€šç”¨å¯¹è¯åŠ©æ‰‹"
    
    async def process_query(self, query: str, entities: Dict[str, Any], 
                          filters: List[str]) -> SkillResult:
        """å¤„ç†é—®å€™å’Œé€šç”¨å¯¹è¯"""
        query_lower = query.lower()
        
        # é—®å€™è¯­å¤„ç†
        if any(greeting in query_lower for greeting in ['ä½ å¥½', 'hello', 'hi', 'å—¨']):
            content = self._handle_greeting()
        elif any(thanks in query_lower for thanks in ['è°¢è°¢', 'æ„Ÿè°¢', 'thank']):
            content = self._handle_thanks()
        elif any(goodbye in query_lower for goodbye in ['å†è§', 'æ‹œæ‹œ', 'bye', 'goodbye']):
            content = self._handle_goodbye()
        elif any(help_word in query_lower for help_word in ['å¸®åŠ©', 'ä»‹ç»', 'åŠŸèƒ½', 'èƒ½åšä»€ä¹ˆ']):
            content = self._handle_help()
        else:
            content = self._handle_general_chat(query)
        
        return SkillResult(
            success=True,
            content=content,
            sources=[],
            confidence=0.8,
            metadata={"skill": "greeting", "type": "general_chat"}
        )
    
    def _handle_greeting(self) -> str:
        """å¤„ç†é—®å€™"""
        return """ğŸ‘‹ **é€šç”¨å¯¹è¯åŠ©æ‰‹**ä¸ºæ‚¨æœåŠ¡ï¼

æ‚¨å¥½ï¼æˆ‘æ˜¯æ ¡å›­æ™ºèƒ½åŠ©æ‰‹ï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ï¼

ğŸ¯ **æˆ‘å¯ä»¥å¸®æ‚¨å¤„ç†**ï¼š
- ğŸ¥ **åŒ»ç–—æŠ¥é”€** - æŠ¥é”€æµç¨‹ã€ææ–™è¦æ±‚ã€æ¯”ä¾‹æ ‡å‡†
- ğŸ“ **è”ç³»äººæŸ¥è¯¢** - è€å¸ˆè”ç³»æ–¹å¼ã€éƒ¨é—¨ä¿¡æ¯
- ğŸ“ **å­¦ä¹ æŒ‡å¯¼** - å‡å­¦è§„åˆ’ã€ä¸“ä¸šå‘å±•ã€ç§‘ç ”æŒ‡å¯¼
- ğŸ’¬ **æ—¥å¸¸å¯¹è¯** - èŠå¤©äº¤æµã€é—®é¢˜è§£ç­”

è¯·å‘Šè¯‰æˆ‘æ‚¨éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Œæˆ‘ä¼šå°½åŠ›ä¸ºæ‚¨æä¾›å‡†ç¡®çš„ä¿¡æ¯ï¼"""
    
    def _handle_thanks(self) -> str:
        """å¤„ç†æ„Ÿè°¢"""
        return """ğŸ˜Š **é€šç”¨å¯¹è¯åŠ©æ‰‹**ä¸ºæ‚¨æœåŠ¡ï¼

ä¸å®¢æ°”ï¼å¾ˆé«˜å…´èƒ½å¸®åŠ©åˆ°æ‚¨ï¼

å¦‚æœæ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œéšæ—¶å¯ä»¥é—®æˆ‘ã€‚æˆ‘ä¼šç»§ç»­ä¸ºæ‚¨æä¾›æ ¡å›­ç”Ÿæ´»å„æ–¹é¢çš„å¸®åŠ©ã€‚

ç¥æ‚¨å­¦ä¹ ç”Ÿæ´»æ„‰å¿«ï¼âœ¨"""
    
    def _handle_goodbye(self) -> str:
        """å¤„ç†å‘Šåˆ«"""
        return """ğŸ‘‹ **é€šç”¨å¯¹è¯åŠ©æ‰‹**ä¸ºæ‚¨æœåŠ¡ï¼

å†è§ï¼å¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ï¼

å¦‚æœä»¥åæœ‰ä»»ä½•æ ¡å›­ç”Ÿæ´»ç›¸å…³çš„é—®é¢˜ï¼Œéšæ—¶æ¬¢è¿å›æ¥å’¨è¯¢ã€‚

ç¥æ‚¨ä¸€åˆ‡é¡ºåˆ©ï¼ğŸŒŸ"""
    
    def _handle_help(self) -> str:
        """å¤„ç†å¸®åŠ©è¯·æ±‚"""
        return """ğŸ¤– **é€šç”¨å¯¹è¯åŠ©æ‰‹**ä¸ºæ‚¨æœåŠ¡ï¼

æˆ‘æ˜¯åŒ—äº¬äº¤é€šå¤§å­¦å¨æµ·æ ¡åŒºçš„æ ¡å›­æ™ºèƒ½åŠ©æ‰‹ï¼Œé‡‡ç”¨æœ€æ–°çš„æ„å›¾è·¯ç”±æŠ€æœ¯ï¼Œå¯ä»¥æ™ºèƒ½è¯†åˆ«æ‚¨çš„éœ€æ±‚å¹¶è°ƒç”¨ä¸“ä¸šAgentä¸ºæ‚¨æœåŠ¡ã€‚

ğŸ¯ **ä¸»è¦åŠŸèƒ½**ï¼š

**ğŸ¥ åŠäº‹æµç¨‹åŠ©æ‰‹**
- åŒ»ç–—æŠ¥é”€æµç¨‹å’Œææ–™è¦æ±‚
- å­¦ç±ç®¡ç†ã€å®¿èˆç”³è¯·
- è¯æ˜å¼€å…·ã€æ‰‹ç»­åŠç†

**ğŸ“ è”ç³»äººåŠ©æ‰‹**  
- è€å¸ˆè”ç³»æ–¹å¼æŸ¥è¯¢
- éƒ¨é—¨çª—å£ä¿¡æ¯
- åŠå…¬åœ°ç‚¹å’Œæ—¶é—´

**ğŸ“ è¯¾ç¨‹å­¦ä¹ åŠ©æ‰‹**
- å‡å­¦è§„åˆ’æŒ‡å¯¼ï¼ˆä¿ç ”/è€ƒç ”/ç•™å­¦ï¼‰
- CSä¸“ä¸šå‘å±•æ–¹å‘
- å­¦ä¹ èµ„æºæ¨è
- ç§‘ç ”é¡¹ç›®æŒ‡å¯¼

**ğŸ’¬ é€šç”¨å¯¹è¯**
- æ—¥å¸¸èŠå¤©äº¤æµ
- é—®é¢˜è§£ç­”
- æ ¡å›­ç”Ÿæ´»å’¨è¯¢

è¯·ç›´æ¥è¯´å‡ºæ‚¨çš„é—®é¢˜ï¼Œæˆ‘ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶ä¸ºæ‚¨æä¾›ä¸“ä¸šå¸®åŠ©ï¼"""
    
    def _handle_general_chat(self, query: str) -> str:
        """å¤„ç†é€šç”¨å¯¹è¯"""
        return f"""ğŸ’¬ **é€šç”¨å¯¹è¯åŠ©æ‰‹**ä¸ºæ‚¨æœåŠ¡ï¼

æˆ‘ç†è§£æ‚¨çš„é—®é¢˜ï¼š"{query}"

ä½œä¸ºæ ¡å›­æ™ºèƒ½åŠ©æ‰‹ï¼Œæˆ‘ä¸»è¦ä¸“æ³¨äºæ ¡å›­ç”Ÿæ´»ç›¸å…³çš„æœåŠ¡ï¼ŒåŒ…æ‹¬ï¼š
- åŒ»ç–—æŠ¥é”€å’ŒåŠäº‹æµç¨‹
- è”ç³»äººå’Œéƒ¨é—¨æŸ¥è¯¢  
- å­¦ä¹ è§„åˆ’å’Œä¸“ä¸šæŒ‡å¯¼

å¦‚æœæ‚¨æœ‰è¿™äº›æ–¹é¢çš„é—®é¢˜ï¼Œæˆ‘ä¼šä¸ºæ‚¨æä¾›è¯¦ç»†å¸®åŠ©ã€‚å¦‚æœæ˜¯å…¶ä»–è¯é¢˜ï¼Œæˆ‘ä¹Ÿå¯ä»¥å°è¯•ä¸æ‚¨äº¤æµï¼Œä½†å¯èƒ½æ— æ³•æä¾›ä¸“ä¸šå»ºè®®ã€‚

è¯·å‘Šè¯‰æˆ‘æ‚¨å…·ä½“éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Ÿ"""
    
    def get_skill_info(self) -> Dict[str, Any]:
        """è·å–æŠ€èƒ½ä¿¡æ¯"""
        return {
            "name": self.skill_name,
            "knowledge_categories": ["greeting", "general_chat"],
            "total_items": 0,
            "status": "active"
        }
    
    def get_supported_queries(self) -> List[str]:
        """è·å–æ”¯æŒçš„æŸ¥è¯¢ç±»å‹"""
        return [
            "é—®å€™è¯­å¤„ç†",
            "æ„Ÿè°¢å›åº”", 
            "å‘Šåˆ«å¤„ç†",
            "å¸®åŠ©è¯·æ±‚",
            "é€šç”¨å¯¹è¯"
        ]
    
    def get_quick_actions(self) -> List[Dict[str, str]]:
        """è·å–å¿«é€Ÿæ“ä½œ"""
        return [
            {"title": "é—®å€™", "query": "ä½ å¥½"},
            {"title": "å¸®åŠ©", "query": "ä½ èƒ½åšä»€ä¹ˆï¼Ÿ"},
            {"title": "æ„Ÿè°¢", "query": "è°¢è°¢"},
            {"title": "å‘Šåˆ«", "query": "å†è§"}
        ]
