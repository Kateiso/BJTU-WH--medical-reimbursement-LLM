# ğŸš€ éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ¦‚è¿°

**é¡¹ç›®**: æ ¡å›­æ™ºèƒ½åŠ©æ‰‹  
**å½“å‰éƒ¨ç½²**: Railway (æµ·å¤–)  
**ç›®æ ‡éƒ¨ç½²**: é˜¿é‡Œäº‘ (å›½å†…)  
**éƒ¨ç½²æ–¹å¼**: Dockerå®¹å™¨åŒ–  

---

## ğŸ¯ å½“å‰éƒ¨ç½² (Railway)

### éƒ¨ç½²ä¿¡æ¯
- **å¹³å°**: Railway
- **åŸŸå**: www.bjtuai.cn
- **çŠ¶æ€**: ç”Ÿäº§ç¯å¢ƒè¿è¡Œä¸­
- **æˆæœ¬**: å…è´¹

### éƒ¨ç½²æµç¨‹
```bash
# 1. æ¨é€ä»£ç åˆ°GitHub
git add .
git commit -m "Update application"
git push origin main

# 2. Railwayè‡ªåŠ¨éƒ¨ç½²
# - æ£€æµ‹åˆ°ä»£ç æ¨é€
# - è‡ªåŠ¨æ„å»ºDockeré•œåƒ
# - éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
# - æ›´æ–°åŸŸåè§£æ
```

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# Railwayç¯å¢ƒå˜é‡
DASHSCOPE_API_KEY=your_api_key_here
PORT=8080
```

### ç›‘æ§å’Œæ—¥å¿—
- **è®¿é—®ç»Ÿè®¡**: https://www.bjtuai.cn/stats
- **å¥åº·æ£€æŸ¥**: https://www.bjtuai.cn/health
- **Railwayæ§åˆ¶å°**: æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€å’Œæ—¥å¿—

---

## ğŸ¯ ç›®æ ‡éƒ¨ç½² (é˜¿é‡Œäº‘)

### éƒ¨ç½²æ¶æ„
```
GitHub Repository
       â†“
   GitHub Actions
       â†“
   Docker Registry
       â†“
   ECS + RDS
       â†“
   www.bjtuai.cn (å·²å¤‡æ¡ˆ)
```

### èµ„æºè§„åˆ’
```
ECSé…ç½®:
- CPU: 1æ ¸
- å†…å­˜: 2GB
- å­˜å‚¨: 40GBç³»ç»Ÿç›˜
- å¸¦å®½: 1Mbps
- ç³»ç»Ÿ: Ubuntu 20.04

RDSé…ç½®:
- å¼•æ“: MySQL 8.0
- è§„æ ¼: 1æ ¸1GB
- å­˜å‚¨: 20GB
- å¤‡ä»½: è‡ªåŠ¨å¤‡ä»½
```

### éƒ¨ç½²æ­¥éª¤

#### 1. å‡†å¤‡é˜¿é‡Œäº‘èµ„æº
```bash
# æ³¨å†Œé˜¿é‡Œäº‘è´¦å·
# ç”³è¯·å…è´¹ECSå’ŒRDS
# é…ç½®å®‰å…¨ç»„å’Œç½‘ç»œ
```

#### 2. é…ç½®GitHub Actions
```yaml
# .github/workflows/deploy.yml
name: Deploy to Alibaba Cloud
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Deploy to ECS
        run: |
          # éƒ¨ç½²è„šæœ¬
```

#### 3. æ•°æ®åº“è¿ç§»
```bash
# ä»JSONæ–‡ä»¶è¿ç§»åˆ°MySQL
python scripts/migrate_to_mysql.py
```

#### 4. åŸŸåå’ŒSSLé…ç½®
```bash
# é…ç½®åŸŸåè§£æ
# ç”³è¯·SSLè¯ä¹¦
# é…ç½®HTTPS
```

---

## ğŸ³ Dockeréƒ¨ç½²

### Dockerfile
```dockerfile
FROM python:3.11-slim

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# å®‰è£…Pythonä¾èµ–
COPY requirements.txt /app/requirements.txt
RUN pip install --no-cache-dir -r /app/requirements.txt

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . /app

# æš´éœ²ç«¯å£
EXPOSE 8080

# å¯åŠ¨å‘½ä»¤
CMD ["python", "qwen_stream_app.py"]
```

### æœ¬åœ°Dockeréƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
docker build -t campus-ai .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name campus-ai \
  -p 8081:8081 \
  -e DASHSCOPE_API_KEY=your_key \
  campus-ai

# æŸ¥çœ‹æ—¥å¿—
docker logs campus-ai

# åœæ­¢å®¹å™¨
docker stop campus-ai
```

### Docker Composeéƒ¨ç½²
```yaml
# docker-compose.yml
version: '3.8'
services:
  app:
    build: .
    ports:
      - "8081:8081"
    environment:
      - DASHSCOPE_API_KEY=${DASHSCOPE_API_KEY}
    volumes:
      - ./data:/app/data
    restart: unless-stopped
```

---

## ğŸ”§ ç¯å¢ƒé…ç½®

### å¼€å‘ç¯å¢ƒ
```bash
# ç¯å¢ƒå˜é‡
export DASHSCOPE_API_KEY=your_api_key
export DEBUG=true
export LOG_LEVEL=DEBUG

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
python qwen_stream_app.py
```

### æµ‹è¯•ç¯å¢ƒ
```bash
# ç¯å¢ƒå˜é‡
export DASHSCOPE_API_KEY=test_api_key
export DEBUG=false
export LOG_LEVEL=INFO

# è¿è¡Œæµ‹è¯•
pytest tests/
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# ç¯å¢ƒå˜é‡
export DASHSCOPE_API_KEY=production_api_key
export DEBUG=false
export LOG_LEVEL=WARNING
export PORT=8080

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
python qwen_stream_app.py
```

---

## ğŸ“Š ç›‘æ§å’Œè¿ç»´

### å¥åº·æ£€æŸ¥
```bash
# åº”ç”¨å¥åº·æ£€æŸ¥
curl http://localhost:8081/health

# å“åº”ç¤ºä¾‹
{
  "status": "healthy",
  "version": "1.0.0",
  "timestamp": "2025-09-11T10:00:00Z"
}
```

### è®¿é—®ç»Ÿè®¡
```bash
# è·å–è®¿é—®ç»Ÿè®¡
curl http://localhost:8081/stats

# å“åº”ç¤ºä¾‹
{
  "total_visits": 1000,
  "unique_visitors": 500,
  "today_visits": 50,
  "most_popular_endpoint": "/web"
}
```

### æ—¥å¿—ç®¡ç†
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/app.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep "ERROR" logs/app.log

# æŸ¥çœ‹è®¿é—®æ—¥å¿—
grep "è®¿é—®ç»Ÿè®¡" logs/app.log
```

---

## ğŸ”’ å®‰å…¨é…ç½®

### é˜²ç«å¢™é…ç½®
```bash
# åªå¼€æ”¾å¿…è¦ç«¯å£
ufw allow 22    # SSH
ufw allow 80    # HTTP
ufw allow 443   # HTTPS
ufw enable
```

### SSLè¯ä¹¦é…ç½®
```bash
# ä½¿ç”¨Let's Encrypt
certbot --nginx -d www.bjtuai.cn

# è‡ªåŠ¨ç»­æœŸ
crontab -e
# æ·»åŠ : 0 12 * * * /usr/bin/certbot renew --quiet
```

### è®¿é—®æ§åˆ¶
```python
# é¢‘ç‡é™åˆ¶é…ç½®
RATE_LIMIT = {
    "max_requests_per_minute": 60,
    "max_requests_per_hour": 1000,
    "blocked_ips": set(),
    "whitelist": {"127.0.0.1", "::1"}
}
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜é…ç½®
```python
# Redisç¼“å­˜é…ç½®
REDIS_CONFIG = {
    "host": "localhost",
    "port": 6379,
    "db": 0,
    "password": None
}
```

### æ•°æ®åº“ä¼˜åŒ–
```sql
-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_knowledge_category ON knowledge_base(category);
CREATE INDEX idx_knowledge_tags ON knowledge_base(tags);

-- æŸ¥è¯¢ä¼˜åŒ–
EXPLAIN SELECT * FROM knowledge_base WHERE category = 'policy';
```

### CDNé…ç½®
```bash
# é˜¿é‡Œäº‘CDNé…ç½®
# é™æ€èµ„æºç¼“å­˜
# å›¾ç‰‡ã€CSSã€JSæ–‡ä»¶ç¼“å­˜
# å…¨çƒèŠ‚ç‚¹åŠ é€Ÿ
```

---

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. åº”ç”¨æ— æ³•å¯åŠ¨
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 8081

# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $DASHSCOPE_API_KEY

# æ£€æŸ¥ä¾èµ–
pip list | grep fastapi
```

#### 2. WebSocketè¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥é˜²ç«å¢™
ufw status

# æ£€æŸ¥ä»£ç†è®¾ç½®
curl -I http://localhost:8081/ws

# æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
# æŸ¥çœ‹WebSocketè¿æ¥é”™è¯¯
```

#### 3. AIæœåŠ¡è°ƒç”¨å¤±è´¥
```bash
# æ£€æŸ¥APIå¯†é’¥
python -c "import os; print(os.getenv('DASHSCOPE_API_KEY'))"

# æµ‹è¯•APIè¿æ¥
curl -H "Authorization: Bearer $DASHSCOPE_API_KEY" \
     https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation
```

### æ—¥å¿—åˆ†æ
```bash
# é”™è¯¯æ—¥å¿—åˆ†æ
grep "ERROR" logs/app.log | tail -20

# æ€§èƒ½åˆ†æ
grep "å“åº”æ—¶é—´" logs/app.log | awk '{print $NF}' | sort -n

# è®¿é—®åˆ†æ
grep "è®¿é—®ç»Ÿè®¡" logs/app.log | tail -10
```

---

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] ä»£ç å·²æäº¤åˆ°GitHub
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] ä¾èµ–å·²å®‰è£…
- [ ] æµ‹è¯•å·²é€šè¿‡

### éƒ¨ç½²åæ£€æŸ¥
- [ ] åº”ç”¨æ­£å¸¸å¯åŠ¨
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] WebSocketè¿æ¥æ­£å¸¸
- [ ] AIæœåŠ¡è°ƒç”¨æ­£å¸¸
- [ ] è®¿é—®ç»Ÿè®¡æ­£å¸¸

### ç›‘æ§æ£€æŸ¥
- [ ] æ—¥å¿—æ­£å¸¸è®°å½•
- [ ] é”™è¯¯ç›‘æ§æ­£å¸¸
- [ ] æ€§èƒ½ç›‘æ§æ­£å¸¸
- [ ] å®‰å…¨ç›‘æ§æ­£å¸¸

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

**è¿ç»´è´Ÿè´£äºº**: æ›¹ç›Šæ³¢  
**é‚®ç®±**: C.yibo2@gmail.com  
**ç”µè¯**: 19862294890  

**ç´§æ€¥è”ç³»**: 24å°æ—¶æŠ€æœ¯æ”¯æŒ

---

*æœ€åæ›´æ–°: 2025-09-11*
*ç‰ˆæœ¬: v1.0*
