# ğŸš€ æ–°æ¶æ„éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ¦‚è§ˆ

æ–°æ¶æ„ç³»ç»Ÿé‡‡ç”¨**æ„å›¾è·¯ç”±+å¤šåŸŸAgent**è®¾è®¡ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•å’Œæ’ä»¶åŒ–å¼€å‘ã€‚

### ğŸ—ï¸ æ¶æ„ç‰¹ç‚¹
- **å•å…¥å£å¯¹è¯**: `/ask` ç»Ÿä¸€å¯¹è¯ç•Œé¢
- **æ™ºèƒ½è·¯ç”±**: è‡ªåŠ¨è¯†åˆ«ç”¨æˆ·æ„å›¾ï¼Œåˆ†å‘åˆ°ä¸“ä¸šAgent
- **å¤šåŸŸå¤„ç†**: Processã€Contactã€Courseã€Policyä¸“ä¸šAgent
- **åˆ†ç‰‡çŸ¥è¯†åº“**: YAMLç»“æ„åŒ–å­˜å‚¨ï¼Œæ™ºèƒ½æ£€ç´¢
- **æµå¼å“åº”**: å®æ—¶æ˜¾ç¤ºå¤„ç†è¿‡ç¨‹

## ğŸ”§ éƒ¨ç½²æ­¥éª¤

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
export DASHSCOPE_API_KEY=your_api_key_here
export PORT=8081
```

### 2. å¯åŠ¨æ–°æ¶æ„åº”ç”¨

```bash
# å¯åŠ¨æ–°æ¶æ„åº”ç”¨
python qwen_router_app.py
```

### 3. éªŒè¯éƒ¨ç½²

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8081/health

# è®¿é—®ç»Ÿè®¡
curl http://localhost:8081/stats

# æµ‹è¯•WebSocket
curl -N -H "Connection: Upgrade" -H "Upgrade: websocket" -H "Sec-WebSocket-Key: test" -H "Sec-WebSocket-Version: 13" http://localhost:8081/ws
```

## ğŸŒ è®¿é—®åœ°å€

- **ç»Ÿä¸€å¯¹è¯ç•Œé¢**: http://localhost:8081/ask
- **APIæ–‡æ¡£**: http://localhost:8081/docs
- **å¥åº·æ£€æŸ¥**: http://localhost:8081/health
- **è®¿é—®ç»Ÿè®¡**: http://localhost:8081/stats

## ğŸ“Š ç³»ç»Ÿç›‘æ§

### å¥åº·æ£€æŸ¥å“åº”
```json
{
  "status": "healthy",
  "version": "2.0.0",
  "architecture": "intent_router_multi_skills",
  "qwen_api": {
    "status": "healthy",
    "model": "qwen-plus"
  },
  "skills": {
    "process": {
      "name": "åŠäº‹æµç¨‹åŠ©æ‰‹",
      "status": "active",
      "total_items": 8
    },
    "contact": {
      "name": "è”ç³»äººåŠ©æ‰‹", 
      "status": "active",
      "total_items": 8
    }
  },
  "total_skills": 2
}
```

### è®¿é—®ç»Ÿè®¡å“åº”
```json
{
  "total_visits": 100,
  "unique_visitors": 50,
  "most_used_skill": "process",
  "skill_usage": {
    "process": 60,
    "contact": 40
  },
  "intent_accuracy": {
    "process": 0.95,
    "contact": 0.98
  }
}
```

## ğŸ”„ ä»æ—§ç‰ˆæœ¬è¿ç§»

### 1. å¤‡ä»½æ—§ç‰ˆæœ¬
```bash
# å¤‡ä»½æ—§åº”ç”¨
cp qwen_stream_app.py qwen_stream_app_backup.py
cp data/knowledge_base.json data/knowledge_base_backup.json
```

### 2. æ•°æ®è¿ç§»
```bash
# çŸ¥è¯†åº“å·²è‡ªåŠ¨è¿ç§»åˆ°åˆ†ç‰‡ç»“æ„
# data/process/reimbursement.yml
# data/contacts/teachers.yml
# data/policy/reimbursement.md
```

### 3. åˆ‡æ¢åº”ç”¨
```bash
# åœæ­¢æ—§åº”ç”¨
pkill -f qwen_stream_app.py

# å¯åŠ¨æ–°åº”ç”¨
python qwen_router_app.py
```

## ğŸ³ Dockeréƒ¨ç½²

### Dockerfile
```dockerfile
FROM python:3.11-slim

WORKDIR /app

# å®‰è£…ä¾èµ–
COPY requirements.txt .
RUN pip install -r requirements.txt

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 8080

# å¯åŠ¨å‘½ä»¤
CMD ["python", "qwen_router_app.py"]
```

### æ„å»ºå’Œè¿è¡Œ
```bash
# æ„å»ºé•œåƒ
docker build -t campus-assistant-v2 .

# è¿è¡Œå®¹å™¨
docker run -p 8080:8080 -e DASHSCOPE_API_KEY=your_key campus-assistant-v2
```

## â˜ï¸ äº‘å¹³å°éƒ¨ç½²

### Railwayéƒ¨ç½²
```json
{
  "build": {
    "builder": "DOCKERFILE",
    "dockerfilePath": "Dockerfile"
  },
  "deploy": {
    "startCommand": "python qwen_router_app.py",
    "healthcheckPath": "/health"
  }
}
```

### ç¯å¢ƒå˜é‡é…ç½®
```bash
DASHSCOPE_API_KEY=your_api_key
PORT=8080
```

## ğŸ”§ é…ç½®ä¼˜åŒ–

### æ€§èƒ½è°ƒä¼˜
```python
# åœ¨qwen_router_app.pyä¸­è°ƒæ•´
rate_limit = {
    "max_requests_per_minute": 100,  # æé«˜é™åˆ¶
    "max_requests_per_hour": 2000,   # æé«˜é™åˆ¶
}

# çŸ¥è¯†åº“ç¼“å­˜
knowledge_cache = {
    "enabled": True,
    "ttl": 3600  # 1å°æ—¶ç¼“å­˜
}
```

### æ—¥å¿—é…ç½®
```python
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('app.log'),
        logging.StreamHandler()
    ]
)
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **SkillsåŠ è½½å¤±è´¥**
   ```bash
   # æ£€æŸ¥çŸ¥è¯†åº“æ–‡ä»¶
   ls -la data/process/
   ls -la data/contacts/
   
   # æ£€æŸ¥YAMLæ ¼å¼
   python -c "import yaml; yaml.safe_load(open('data/process/reimbursement.yml'))"
   ```

2. **æ„å›¾è·¯ç”±ä¸å‡†ç¡®**
   ```bash
   # æµ‹è¯•æ„å›¾è¯†åˆ«
   python src/core/router/intent_router.py
   ```

3. **WebSocketè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   lsof -i :8081
   
   # æ£€æŸ¥é˜²ç«å¢™
   ufw status
   ```

### æ€§èƒ½ç›‘æ§
```bash
# ç›‘æ§ç³»ç»Ÿèµ„æº
htop

# ç›‘æ§åº”ç”¨æ—¥å¿—
tail -f app.log

# ç›‘æ§è®¿é—®ç»Ÿè®¡
curl http://localhost:8081/stats | jq
```

## ğŸ“ˆ æ‰©å±•å¼€å‘

### æ·»åŠ æ–°Skill
1. ç»§æ‰¿`BaseSkill`ç±»
2. å®ç°`process_query`æ–¹æ³•
3. åœ¨`qwen_router_app.py`ä¸­æ³¨å†Œ
4. æ·»åŠ å¯¹åº”çš„çŸ¥è¯†åº“æ–‡ä»¶

### æ·»åŠ æ–°æ„å›¾
1. åœ¨`intent_router.py`ä¸­æ·»åŠ æ¨¡å¼
2. æ›´æ–°`SkillType`æšä¸¾
3. å®ç°å¯¹åº”çš„Skillç±»

## ğŸ”’ å®‰å…¨é…ç½®

### è®¿é—®æ§åˆ¶
```python
# IPç™½åå•
whitelist = {
    "127.0.0.1",
    "::1",
    "your_trusted_ip"
}

# é¢‘ç‡é™åˆ¶
rate_limit = {
    "max_requests_per_minute": 60,
    "max_requests_per_hour": 1000
}
```

### è¾“å…¥éªŒè¯
```python
# æ¶æ„è¾“å…¥æ£€æµ‹
dangerous_patterns = [
    '<script', 'javascript:', 'eval(', 
    'exec(', 'import os', 'subprocess'
]
```

---

**ğŸ¯ éƒ¨ç½²ç›®æ ‡**: ç¡®ä¿æ–°æ¶æ„ç³»ç»Ÿç¨³å®šè¿è¡Œï¼Œæ”¯æŒé«˜å¹¶å‘è®¿é—®

**ğŸŒŸ ç›‘æ§é‡ç‚¹**: æ„å›¾è¯†åˆ«å‡†ç¡®ç‡ã€æŠ€èƒ½å“åº”æ—¶é—´ã€ç”¨æˆ·æ»¡æ„åº¦

*Built with â¤ï¸ using æ„å›¾è·¯ç”± + å¤šåŸŸAgentæ¶æ„*
