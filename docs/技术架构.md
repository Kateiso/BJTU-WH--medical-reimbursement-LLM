# ğŸ—ï¸ æŠ€æœ¯æ¶æ„æ–‡æ¡£

## ğŸ“Š æ¶æ„æ¦‚è¿°

**ç³»ç»Ÿåç§°**: æ ¡å›­æ™ºèƒ½åŠ©æ‰‹  
**æ¶æ„ç‰ˆæœ¬**: v1.0  
**æŠ€æœ¯æ ˆ**: Python + FastAPI + é€šä¹‰åƒé—® + RAG  
**éƒ¨ç½²æ–¹å¼**: Docker + Railway  

---

## ğŸ¯ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·ç•Œé¢      â”‚    â”‚   Web API       â”‚    â”‚   AIæœåŠ¡        â”‚
â”‚   (Frontend)    â”‚â—„â”€â”€â–ºâ”‚   (FastAPI)     â”‚â—„â”€â”€â–ºâ”‚   (é€šä¹‰åƒé—®)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WebSocket     â”‚    â”‚   çŸ¥è¯†åº“        â”‚    â”‚   è®¿é—®æ§åˆ¶      â”‚
â”‚   (å®æ—¶é€šä¿¡)    â”‚    â”‚   (JSON)        â”‚    â”‚   (é¢‘ç‡é™åˆ¶)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆè¯¦æƒ…

#### åç«¯æŠ€æœ¯
- **æ¡†æ¶**: FastAPI 0.111.0
- **è¯­è¨€**: Python 3.11
- **æœåŠ¡å™¨**: Uvicorn
- **AIæ¨¡å‹**: é˜¿é‡Œé€šä¹‰åƒé—® (Qwen-Plus)
- **çŸ¥è¯†åº“**: JSONæ–‡ä»¶å­˜å‚¨
- **é€šä¿¡**: WebSocket + HTTP

#### å‰ç«¯æŠ€æœ¯
- **ç•Œé¢**: HTML5 + CSS3 + JavaScript
- **æ¸²æŸ“**: Marked.js (Markdown)
- **é«˜äº®**: Highlight.js (ä»£ç é«˜äº®)
- **é€šä¿¡**: WebSocket + Fetch API
- **æ ·å¼**: å“åº”å¼è®¾è®¡

#### éƒ¨ç½²æŠ€æœ¯
- **å®¹å™¨åŒ–**: Docker
- **å¹³å°**: Railway
- **åŸŸå**: www.bjtuai.cn
- **SSL**: è‡ªåŠ¨HTTPS

---

## ğŸ”§ æ ¸å¿ƒæ¨¡å—

### 1. ä¸»åº”ç”¨æ¨¡å— (qwen_stream_app.py)

#### åŠŸèƒ½èŒè´£
- åº”ç”¨åˆå§‹åŒ–å’Œé…ç½®
- è·¯ç”±å®šä¹‰å’Œä¸­é—´ä»¶é…ç½®
- WebSocketè¿æ¥ç®¡ç†
- è®¿é—®ç»Ÿè®¡å’Œç›‘æ§

#### å…³é”®ç»„ä»¶
```python
# åº”ç”¨é…ç½®
app = FastAPI(
    title="åŒ»ç–—æŠ¥é”€æ™ºèƒ½åŠ©æ‰‹",
    version="1.0.0",
    description="åŸºäºé€šä¹‰åƒé—®çš„åŒ»ç–—æŠ¥é”€æ™ºèƒ½é—®ç­”ç³»ç»Ÿ"
)

# WebSocketç®¡ç†å™¨
class ConnectionManager:
    def __init__(self):
        self.active_connections: List[WebSocket] = []
    
    async def connect(self, websocket: WebSocket):
        await websocket.accept()
        self.active_connections.append(websocket)
```

### 2. RAGå¼•æ“æ¨¡å— (src/core/rag/)

#### åŠŸèƒ½èŒè´£
- çŸ¥è¯†åº“æ£€ç´¢
- ä¸Šä¸‹æ–‡æ„å»º
- AIæ¨¡å‹è°ƒç”¨
- æµå¼å“åº”å¤„ç†

#### æ ¸å¿ƒç±»
```python
class QwenStreamLLM:
    def __init__(self):
        self.api_key = os.getenv("DASHSCOPE_API_KEY")
        self.model = "qwen-plus"
    
    async def rag_generate_stream(self, query: str, context: str):
        # æµå¼ç”Ÿæˆå›ç­”
        pass
```

### 3. çŸ¥è¯†åº“æ¨¡å— (src/core/knowledge/)

#### åŠŸèƒ½èŒè´£
- çŸ¥è¯†åº“åŠ è½½å’Œç®¡ç†
- çŸ¥è¯†æ£€ç´¢å’ŒåŒ¹é…
- æ•°æ®éªŒè¯å’Œæ›´æ–°

#### æ•°æ®ç»“æ„
```json
{
  "knowledge_base": [
    {
      "category": "policy",
      "title": "å­¦ç”Ÿé—¨è¯ŠæŠ¥é”€æ¯”ä¾‹",
      "content": "å…·ä½“æ”¿ç­–å†…å®¹...",
      "tags": ["é—¨è¯Š", "æŠ¥é”€æ¯”ä¾‹", "å­¦ç”Ÿ"]
    }
  ]
}
```

### 4. APIæ¨¡å— (src/core/api/)

#### åŠŸèƒ½èŒè´£
- RESTful APIæ¥å£
- æ•°æ®æ¨¡å‹å®šä¹‰
- è¯·æ±‚éªŒè¯å’Œå“åº”

#### ä¸»è¦æ¥å£
- `GET /health` - å¥åº·æ£€æŸ¥
- `GET /stats` - è®¿é—®ç»Ÿè®¡
- `WebSocket /ws` - å®æ—¶é—®ç­”

---

## ğŸ”’ å®‰å…¨æ¶æ„

### è®¿é—®æ§åˆ¶
```python
# é¢‘ç‡é™åˆ¶é…ç½®
rate_limit = {
    "max_requests_per_minute": 60,
    "max_requests_per_hour": 1000,
    "blocked_ips": set(),
    "whitelist": {"127.0.0.1", "::1"}
}
```

### è¾“å…¥éªŒè¯
```python
# æ¶æ„è¾“å…¥æ£€æµ‹
dangerous_patterns = [
    '<script', 'javascript:', 'eval(', 
    'exec(', 'import os', 'subprocess'
]
```

### ç¯å¢ƒå˜é‡ç®¡ç†
```python
# APIå¯†é’¥ç®¡ç†
DASHSCOPE_API_KEY = os.getenv("DASHSCOPE_API_KEY")
```

---

## ğŸ“Š æ•°æ®æµæ¶æ„

### ç”¨æˆ·è¯·æ±‚å¤„ç†æµç¨‹
```
1. ç”¨æˆ·è¾“å…¥é—®é¢˜
   â†“
2. WebSocketæ¥æ”¶è¯·æ±‚
   â†“
3. è¾“å…¥éªŒè¯å’Œè¿‡æ»¤
   â†“
4. çŸ¥è¯†åº“æ£€ç´¢
   â†“
5. ä¸Šä¸‹æ–‡æ„å»º
   â†“
6. AIæ¨¡å‹è°ƒç”¨
   â†“
7. æµå¼å“åº”è¿”å›
   â†“
8. å‰ç«¯æ¸²æŸ“æ˜¾ç¤º
```

### çŸ¥è¯†æ£€ç´¢æµç¨‹
```
1. ç”¨æˆ·é—®é¢˜åˆ†æ
   â†“
2. å…³é”®è¯æå–
   â†“
3. çŸ¥è¯†åº“åŒ¹é…
   â†“
4. ç›¸å…³æ€§è¯„åˆ†
   â†“
5. ç»“æœæ’åº
   â†“
6. ä¸Šä¸‹æ–‡æ„å»º
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥
- **çŸ¥è¯†åº“ç¼“å­˜**: å¯åŠ¨æ—¶åŠ è½½åˆ°å†…å­˜
- **å“åº”ç¼“å­˜**: ç›¸åŒé—®é¢˜ç¼“å­˜ç»“æœ
- **é™æ€èµ„æº**: CDNåŠ é€Ÿ

### å¹¶å‘å¤„ç†
- **å¼‚æ­¥å¤„ç†**: ä½¿ç”¨async/await
- **è¿æ¥æ± **: WebSocketè¿æ¥ç®¡ç†
- **è´Ÿè½½å‡è¡¡**: å¤šå®ä¾‹éƒ¨ç½²

### ç›‘æ§æŒ‡æ ‡
- **å“åº”æ—¶é—´**: < 3ç§’
- **å¹¶å‘æ”¯æŒ**: 50+ ç”¨æˆ·
- **å¯ç”¨æ€§**: > 99%

---

## ğŸ”„ éƒ¨ç½²æ¶æ„

### å½“å‰éƒ¨ç½² (Railway)
```
GitHub Repository
       â†“
   Railway CI/CD
       â†“
   Docker Container
       â†“
   Production Server
       â†“
   www.bjtuai.cn
```

### ç›®æ ‡éƒ¨ç½² (é˜¿é‡Œäº‘)
```
GitHub Repository
       â†“
   GitHub Actions
       â†“
   Docker Registry
       â†“
   ECS + RDS
       â†“
   www.bjtuai.cn (å·²å¤‡æ¡ˆ)
```

---

## ğŸ“ˆ æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•
- **æ— çŠ¶æ€è®¾è®¡**: æ”¯æŒå¤šå®ä¾‹éƒ¨ç½²
- **è´Ÿè½½å‡è¡¡**: è¯·æ±‚åˆ†å‘
- **æ•°æ®åº“åˆ†ç¦»**: ç‹¬ç«‹æ•°æ®åº“æœåŠ¡

### å‚ç›´æ‰©å±•
- **æ¨¡å—åŒ–è®¾è®¡**: åŠŸèƒ½æ¨¡å—ç‹¬ç«‹
- **æ’ä»¶æ¶æ„**: æ”¯æŒåŠŸèƒ½æ‰©å±•
- **é…ç½®é©±åŠ¨**: é€šè¿‡é…ç½®æ§åˆ¶åŠŸèƒ½

---

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒ

### æœ¬åœ°å¼€å‘
```bash
# ç¯å¢ƒè¦æ±‚
Python 3.11+
Docker (å¯é€‰)

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
export DASHSCOPE_API_KEY=your_key

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
python qwen_stream_app.py
```

### æµ‹è¯•ç¯å¢ƒ
```bash
# è¿è¡Œæµ‹è¯•
pytest tests/

# å¥åº·æ£€æŸ¥
curl http://localhost:8081/health

# åŠŸèƒ½æµ‹è¯•
curl http://localhost:8081/stats
```

---

## ğŸ“‹ æŠ€æœ¯å€ºåŠ¡

### å½“å‰é—®é¢˜
1. **æ•°æ®å­˜å‚¨**: JSONæ–‡ä»¶ â†’ æ•°æ®åº“
2. **ç¼“å­˜ç³»ç»Ÿ**: å†…å­˜ç¼“å­˜ â†’ Redis
3. **ç›‘æ§ç³»ç»Ÿ**: åŸºç¡€ç»Ÿè®¡ â†’ å®Œæ•´ç›‘æ§
4. **æ—¥å¿—ç³»ç»Ÿ**: ç®€å•æ‰“å° â†’ ç»“æ„åŒ–æ—¥å¿—

### æ”¹è¿›è®¡åˆ’
1. **æ•°æ®åº“è¿ç§»**: è¿ç§»åˆ°MySQL
2. **ç¼“å­˜ä¼˜åŒ–**: æ·»åŠ Redisç¼“å­˜
3. **ç›‘æ§å®Œå–„**: é›†æˆç›‘æ§ç³»ç»Ÿ
4. **æ—¥å¿—è§„èŒƒ**: ç»“æ„åŒ–æ—¥å¿—è®°å½•

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

**æ¶æ„å¸ˆ**: æ›¹ç›Šæ³¢  
**é‚®ç®±**: C.yibo2@gmail.com  
**ç”µè¯**: 19862294890  

---

*æœ€åæ›´æ–°: 2025-09-11*
*ç‰ˆæœ¬: v1.0*
