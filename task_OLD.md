# 📋 校园智能助手 - 详细任务清单

## 🎯 项目概述

从医疗报销垂直领域起步，逐步扩展为全方位的校园生活智能助手。

**当前状态**: 阶段1完成 ✅  
**下一目标**: 阶段2 - 校园办事助手 🚧

---

## 🔥 高优先级任务 (立即执行)

### 安全加固

#### 任务1.1: 移除硬编码API密钥 ✅
- **目标**: 将API密钥从代码中移除，使用环境变量管理
- **开始条件**: 当前代码中有硬编码的API密钥
- **结束条件**: 代码中无硬编码密钥，通过环境变量读取
- **测试方法**: 
  ```bash
  # 测试1: 检查代码中无硬编码密钥
  grep -r "sk-2ea7b3f8fb7742828ff836eed6050f19" qwen_stream_app.py
  # 应该返回空结果
  
  # 测试2: 验证环境变量读取
  unset DASHSCOPE_API_KEY
  python -c "import qwen_stream_app"  # 应该报错
  export DASHSCOPE_API_KEY=test_key
  python -c "import qwen_stream_app"  # 应该成功
  ```
- **文件**: `qwen_stream_app.py`
- **预计时间**: 15分钟
- **状态**: ✅ 已完成

#### 任务1.2: 添加输入验证 ✅
- **目标**: 为所有API端点添加输入验证和错误处理
- **开始条件**: 当前API缺少输入验证
- **结束条件**: 所有API端点都有Pydantic模型验证
- **状态**: ✅ 已完成
- **测试方法**:
  ```bash
  # 测试1: 发送无效数据到API
  curl -X POST http://localhost:8081/api/v1/ask \
    -H "Content-Type: application/json" \
    -d '{"invalid": "data"}'
  # 应该返回422错误
  
  # 测试2: 发送空数据
  curl -X POST http://localhost:8081/api/v1/ask \
    -H "Content-Type: application/json" \
    -d '{}'
  # 应该返回验证错误
  ```
- **文件**: `src/core/api/models.py`, `src/core/api/router.py`
- **预计时间**: 30分钟

#### 任务1.3: 实现访问控制 ✅
- **目标**: 添加基本的访问频率限制和IP白名单
- **开始条件**: 当前无访问控制
- **结束条件**: 实现简单的访问限制机制
- **状态**: ✅ 已完成
- **测试方法**:
  ```bash
  # 测试1: 快速连续请求
  for i in {1..10}; do curl http://localhost:8081/health; done
  # 应该在第5次后开始限制
  
  # 测试2: 检查访问日志
  curl http://localhost:8081/stats
  # 应该显示访问统计和限制信息
  ```
- **文件**: `qwen_stream_app.py`
- **预计时间**: 45分钟

### 备案合规

#### 任务2.1: 准备备案材料 ✅
- **目标**: 收集工信部备案所需的所有材料
- **开始条件**: 需要备案但材料未准备
- **结束条件**: 所有备案材料准备完毕
- **测试方法**: 检查材料清单完整性
- **材料清单**:
  - [ ] 域名证书
  - [ ] 服务器租赁合同
  - [x] 网站内容说明
  - [ ] 负责人身份证
  - [x] 网站安全承诺书
- **预计时间**: 2小时
- **状态**: ✅ 已完成

#### 任务2.2: 内容合规检查 ✅
- **目标**: 确保网站内容符合教育类网站要求
- **开始条件**: 需要检查当前内容
- **结束条件**: 所有内容通过合规检查
- **测试方法**: 人工检查所有页面内容
- **检查项目**:
  - [x] 无违法违规内容
  - [x] 医疗信息准确性
  - [x] 联系方式真实性
  - [x] 隐私政策完整
- **预计时间**: 1小时
- **状态**: ✅ 已完成

### 服务器迁移

#### 任务3.1: 注册阿里云账号
- **目标**: 注册阿里云账号并申请免费资源
- **开始条件**: 需要国内服务器支持备案
- **结束条件**: 获得阿里云免费ECS和RDS
- **测试方法**: 验证免费资源可用性
- **资源清单**:
  - [ ] 阿里云账号注册
  - [ ] 免费ECS申请 (1核2G，1年)
  - [ ] 免费RDS申请 (1核1G，6个月)
  - [ ] 备案服务申请
- **预计时间**: 1小时

#### 任务3.2: 准备迁移方案
- **目标**: 制定详细的迁移计划
- **开始条件**: 阿里云资源准备完成
- **结束条件**: 完成迁移方案设计
- **测试方法**: 验证迁移方案可行性
- **方案内容**:
  - [ ] 代码兼容性检查
  - [ ] 数据库迁移方案
  - [ ] 环境变量配置
  - [ ] 部署流程设计
- **预计时间**: 2小时

### 项目重命名

#### 任务4.1: 确定新项目名称
- **目标**: 从"医疗AI"升级为更通用的名称
- **开始条件**: 当前名称过于局限
- **结束条件**: 确定新的项目名称和品牌
- **测试方法**: 内部投票和用户调研
- **候选名称**:
  - [ ] BJTU-AI (交大AI)
  - [ ] SmartCampus (智慧校园)
  - [ ] CampusHub (校园中心)
- **预计时间**: 1小时

#### 任务3.2: 更新项目文档
- **目标**: 将所有文档中的项目名称更新
- **开始条件**: 确定新名称后
- **结束条件**: 所有文档使用新名称
- **测试方法**: 搜索旧名称，确保无残留
- **文件列表**:
  - [ ] README.md
  - [ ] PRD.md
  - [ ] 所有代码注释
  - [ ] 部署配置
- **预计时间**: 30分钟

---

## 📊 中优先级任务 (1-2周内)

### 知识库扩展

#### 任务4.1: 设计学籍管理知识结构
- **目标**: 设计学籍管理相关的知识库结构
- **开始条件**: 需要扩展新领域
- **结束条件**: 完成学籍管理知识分类和字段设计
- **测试方法**: 创建示例数据并验证结构
- **知识分类**:
  - [ ] 学籍证明 (academic_certificate)
  - [ ] 转专业流程 (major_transfer)
  - [ ] 休学复学 (leave_return)
  - [ ] 毕业申请 (graduation)
- **预计时间**: 1小时

#### 任务4.2: 添加学籍管理数据
- **目标**: 向知识库添加学籍管理相关数据
- **开始条件**: 知识结构设计完成
- **结束条件**: 添加至少10条学籍管理知识条目
- **测试方法**:
  ```bash
  # 测试1: 搜索学籍相关内容
  curl -X POST http://localhost:8081/api/v1/search \
    -H "Content-Type: application/json" \
    -d '{"query": "学籍证明", "category": "academic_certificate"}'
  # 应该返回相关结果
  
  # 测试2: 验证数据完整性
  python -c "from qwen_stream_app import load_knowledge_base; kb = load_knowledge_base(); print(len([item for item in kb.get('knowledge_base', []) if item.get('category') == 'academic_certificate']))"
  # 应该返回 >= 10
  ```
- **文件**: `data/knowledge_base.json`
- **预计时间**: 2小时

#### 任务4.3: 添加宿舍管理数据
- **目标**: 添加宿舍申请、管理相关数据
- **开始条件**: 学籍数据添加完成
- **结束条件**: 添加至少8条宿舍管理知识条目
- **测试方法**: 同任务4.2，搜索"宿舍"相关内容
- **预计时间**: 1.5小时

#### 任务4.4: 添加成绩查询数据
- **目标**: 添加成绩查询、证明相关数据
- **开始条件**: 宿舍数据添加完成
- **结束条件**: 添加至少6条成绩相关知识条目
- **测试方法**: 同任务4.2，搜索"成绩"相关内容
- **预计时间**: 1小时

### API完善

#### 任务5.1: 实现知识库CRUD API
- **目标**: 完善知识库的增删改查接口
- **开始条件**: 当前API不完整
- **结束条件**: 所有CRUD操作都有对应的API端点
- **测试方法**:
  ```bash
  # 测试1: 创建知识条目
  curl -X POST http://localhost:8081/api/v1/knowledge \
    -H "Content-Type: application/json" \
    -d '{"category": "test", "title": "测试", "content": "测试内容"}'
  # 应该返回201状态码
  
  # 测试2: 获取知识条目
  curl http://localhost:8081/api/v1/knowledge/{item_id}
  # 应该返回条目详情
  
  # 测试3: 更新知识条目
  curl -X PUT http://localhost:8081/api/v1/knowledge/{item_id} \
    -H "Content-Type: application/json" \
    -d '{"title": "更新后的标题"}'
  # 应该返回200状态码
  
  # 测试4: 删除知识条目
  curl -X DELETE http://localhost:8081/api/v1/knowledge/{item_id}
  # 应该返回204状态码
  ```
- **文件**: `src/core/api/router.py`
- **预计时间**: 2小时

#### 任务5.2: 添加批量操作API
- **目标**: 支持批量导入、导出知识库数据
- **开始条件**: CRUD API完成
- **结束条件**: 实现批量导入导出功能
- **测试方法**:
  ```bash
  # 测试1: 批量导入
  curl -X POST http://localhost:8081/api/v1/knowledge/batch \
    -H "Content-Type: application/json" \
    -d '{"items": [{"category": "test", "title": "批量1"}, {"category": "test", "title": "批量2"}]}'
  # 应该返回批量操作结果
  
  # 测试2: 导出数据
  curl http://localhost:8081/api/v1/knowledge/export
  # 应该返回JSON格式的完整知识库
  ```
- **预计时间**: 1.5小时

### 用户系统

#### 任务6.1: 设计用户数据模型
- **目标**: 设计用户认证和权限管理的数据结构
- **开始条件**: 需要用户系统
- **结束条件**: 完成用户模型设计
- **测试方法**: 创建用户模型并验证字段
- **用户字段**:
  - [ ] 用户ID (user_id)
  - [ ] 用户名 (username)
  - [ ] 邮箱 (email)
  - [ ] 角色 (role: student/teacher/admin)
  - [ ] 创建时间 (created_at)
- **预计时间**: 30分钟

#### 任务6.2: 实现用户注册API
- **目标**: 实现用户注册功能
- **开始条件**: 用户模型设计完成
- **结束条件**: 用户可以通过API注册
- **测试方法**:
  ```bash
  # 测试1: 用户注册
  curl -X POST http://localhost:8081/api/v1/auth/register \
    -H "Content-Type: application/json" \
    -d '{"username": "testuser", "email": "test@bjtu.edu.cn", "password": "password123"}'
  # 应该返回201状态码和用户信息
  
  # 测试2: 重复注册
  curl -X POST http://localhost:8081/api/v1/auth/register \
    -H "Content-Type: application/json" \
    -d '{"username": "testuser", "email": "test@bjtu.edu.cn", "password": "password123"}'
  # 应该返回409冲突错误
  ```
- **预计时间**: 1小时

#### 任务6.3: 实现用户登录API
- **目标**: 实现用户登录和JWT令牌生成
- **开始条件**: 用户注册完成
- **结束条件**: 用户可以通过API登录获取令牌
- **测试方法**:
  ```bash
  # 测试1: 用户登录
  curl -X POST http://localhost:8081/api/v1/auth/login \
    -H "Content-Type: application/json" \
    -d '{"username": "testuser", "password": "password123"}'
  # 应该返回200状态码和JWT令牌
  
  # 测试2: 错误密码
  curl -X POST http://localhost:8081/api/v1/auth/login \
    -H "Content-Type: application/json" \
    -d '{"username": "testuser", "password": "wrongpassword"}'
  # 应该返回401未授权错误
  ```
- **预计时间**: 1小时

---

## 🎯 低优先级任务 (1个月内)

### 移动端开发

#### 任务7.1: 设计移动端UI
- **目标**: 设计适合移动端的用户界面
- **开始条件**: 需要移动端支持
- **结束条件**: 完成移动端UI设计稿
- **测试方法**: 在移动设备上测试响应式设计
- **预计时间**: 4小时

#### 任务7.2: 开发微信小程序
- **目标**: 开发微信小程序版本
- **开始条件**: UI设计完成
- **结束条件**: 小程序可以正常使用
- **测试方法**: 在微信中测试小程序功能
- **预计时间**: 8小时

### 多校扩展

#### 任务8.1: 设计多校配置系统
- **目标**: 设计支持多所学校的配置系统
- **开始条件**: 需要支持其他学校
- **结束条件**: 完成多校配置架构设计
- **测试方法**: 创建多校配置示例
- **预计时间**: 2小时

#### 任务8.2: 实现学校切换功能
- **目标**: 实现用户可以在不同学校间切换
- **开始条件**: 多校配置系统完成
- **结束条件**: 用户可以选择不同学校
- **测试方法**: 测试学校切换功能
- **预计时间**: 3小时

---

## 📈 测试和验证

### 每个任务完成后必须验证

1. **功能测试**: 确保功能按预期工作
2. **回归测试**: 确保没有破坏现有功能
3. **性能测试**: 确保性能没有下降
4. **文档更新**: 更新相关文档

### 测试命令模板

```bash
# 启动应用
python qwen_stream_app.py

# 健康检查
curl http://localhost:8081/health

# 功能测试
curl http://localhost:8081/web

# 统计检查
curl http://localhost:8081/stats
```

---

## 📅 时间规划

- **第1周**: 完成高优先级任务 (安全、备案、重命名)
- **第2-3周**: 完成中优先级任务 (知识库扩展、API完善)
- **第4周**: 完成用户系统基础功能
- **第2个月**: 完成低优先级任务 (移动端、多校扩展)

---

## 🎯 成功标准

项目成功的标准：
1. **安全性**: 通过安全审计，无重大安全漏洞
2. **合规性**: 完成工信部备案，内容合规
3. **功能性**: 支持至少3个校园办事领域
4. **可用性**: 用户满意度 > 90%
5. **性能**: 响应时间 < 3秒，可用性 > 99%

---

*最后更新: 2025-09-11*
*负责人: 曹益波*
